<!-- Generated by SpecStory -->

# ComfyUI目录位置说明 (2025-08-07 14:44Z)

_**User**_

这个是上面原因，ComfyUI目录在~/ComfyUI

---

_**Assistant**_

根据错误信息，这是一个 safetensors 文件损坏的问题。错误 `MetadataIncompleteBuffer` 表示模型文件的元数据不完整，通常是由于下载中断或文件损坏导致的。

让我先检查一下相关的文件和目录结构：

---

<details>
                <summary>Searched codebase "NunchakuFluxTransformer2dModel.from_pretrained safetensors 文件加载" • **13** results</summary>
            
| File | Lines |
|------|-------|
| `workflow/nunchaku-flux.1-fill-removalV2.json` | L479-567 |
| `workflow/nunchaku-flux.1-kontext-dev.json` | L760-830 |
| `workflow/nunchaku-flux.1-dev-pulid.json` | L602-709 |
| `workflow/nunchaku-flux.1-dev-pulid.json` | L556-609 |
| `workflow/nunchaku-flux.1-dev-qencoder.json` | L490-597 |
| `workflow/nunchaku-flux.1-kontext-dev.json` | Lundefined-52 |
| `workflow/nunchaku-flux.1-redux-dev.json` | L1058-1123 |
| `workflow/nunchaku-flux.1-kontext-dev-turbo_lora.json` | Lundefined-52 |
| `workflow/nunchaku-flux.1-dev.json` | L719-801 |
| `workflow/nunchaku-flux.1-schnell.json` | L436-524 |
| `workflow/nunchaku-flux.1-kontext-dev.json` | L550-583 |
| `workflow/nunchaku-flux.1-dev.json` | L640-724 |
| `workflow/nunchaku-flux.1-kontext-dev-turbo_lora.json` | L546-579 |

</details>

---

让我检查一下 ComfyUI 目录和 nunchaku 插件的状态：

---

```bash
cd /home/wjx/ComfyUI && find . -name "*nunchaku*" -type d
```

```
<d /home/wjx/ComfyUI && find . -name "*nunchaku*" -type d
./comfyui_env/lib/python3.12/site-packages/nunchaku
./comfyui_env/lib/python3.12/site-packages/nunchaku-0.3.1+torch2.5.dist-info
./custom_nodes/ComfyUI-nunchaku
wjx@Albert-B650E-AORUS-MASTER:~/ComfyUI$
```

---

现在让我查看 nunchaku 模型文件的存储位置：

---

```bash
cd /home/wjx/ComfyUI && find . -name "*.safetensors" | grep -i nunchaku
```

```
<home/wjx/ComfyUI && find . -name "*.safetensors" | grep -i nunchaku
wjx@Albert-B650E-AORUS-MASTER:~/ComfyUI$
```

---

让我检查一下模型文件存储的标准位置：

---

```bash
cd /home/wjx/ComfyUI && ls -la models/
```

```
wjx@Albert-B650E-AORUS-MASTER:~/ComfyUI$ cd /home/wjx/ComfyUI && ls -la models/
total 156
drwxrwxr-x 39 wjx wjx 4096 Aug  3 20:05 .
drwxrwxr-x 26 wjx wjx 4096 Aug  7 22:46 ..
drwxrwxr-x  2 wjx wjx 4096 Aug  3 18:06 animatediff_models
drwxrwxr-x  2 wjx wjx 4096 Aug  3 18:06 animatediff_motion_lora
drwxrwxr-x  2 wjx wjx 4096 Aug  3 18:06 animatediff_video_formats
drwxrwxr-x  3 wjx wjx 4096 Aug  3 18:06 blip
drwxrwxr-x  3 wjx wjx 4096 Aug  3 18:06 checkpoints
drwxrwxr-x  2 wjx wjx 4096 Aug  3 18:06 clip
drwxrwxr-x  2 wjx wjx 4096 Aug  3 18:06 clip_vision
drwxrwxr-x  2 wjx wjx 4096 Aug  3 18:06 CogVideo
drwxrwxr-x  2 wjx wjx 4096 Aug  3 17:52 configs
drwxrwxr-x  5 wjx wjx 4096 Aug  3 18:06 controlnet
drwxrwxr-x  2 wjx wjx 4096 Aug  3 17:52 diffusers
drwxrwxr-x  5 wjx wjx 4096 Aug  3 20:00 diffusion_models
drwxrwxr-x  2 wjx wjx 4096 Aug  3 17:52 embeddings
drwxrwxr-x  2 wjx wjx 4096 Aug  3 20:04 facerestore_models
drwxrwxr-x  2 wjx wjx 4096 Aug  3 20:04 facexlib
drwxrwxr-x  2 wjx wjx 4096 Aug  3 17:52 gligen
drwxrwxr-x  2 wjx wjx 4096 Aug  3 17:52 hypernetworks
drwxrwxr-x  4 wjx wjx 4096 Aug  3 20:04 insightface
drwxrwxr-x  2 wjx wjx 4096 Aug  3 20:03 Joy_caption
drwxrwxr-x  2 wjx wjx 4096 Aug  3 20:03 layerstyle
drwxrwxr-x  2 wjx wjx 4096 Aug  3 20:04 liveportrait
drwxrwxr-x  2 wjx wjx 4096 Aug  3 20:04 LLM
drwxrwxr-x  3 wjx wjx 4096 Aug  3 18:09 loras
drwxr-xr-x  3 wjx wjx 4096 Aug  3 20:05 Molmo
drwxrwxr-x  2 wjx wjx 4096 Aug  3 20:04 onnx
drwxrwxr-x  2 wjx wjx 4096 Aug  3 17:52 photomaker
drwxrwxr-x  2 wjx wjx 4096 Aug  3 20:04 pulid
drwxrwxr-x  3 wjx wjx 4096 Aug  3 20:04 reactor
drwxrwxr-x  2 wjx wjx 4096 Aug  3 20:04 sams
drwxrwxr-x  2 wjx wjx 4096 Aug  3 20:11 style_models
drwxrwxr-x  3 wjx wjx 4096 Aug  3 20:09 text_encoders
drwxrwxr-x  4 wjx wjx 4096 Aug  3 20:04 ultralytics
drwxrwxr-x  2 wjx wjx 4096 Aug  3 17:52 unet
drwxrwxr-x  2 wjx wjx 4096 Aug  3 20:10 upscale_models
drwxrwxr-x  2 wjx wjx 4096 Aug  3 18:08 vae
drwxrwxr-x  2 wjx wjx 4096 Aug  3 17:52 vae_approx
drwxrwxr-x  4 wjx wjx 4096 Aug  3 20:04 xlabs
wjx@Albert-B650E-AORUS-MASTER:~/ComfyUI$
```

---

让我检查 diffusion_models 目录，这里通常存放 FLUX 模型：

---

```bash
cd /home/wjx/ComfyUI && find models/diffusion_models -name "*flux*" -o -name "*svdq*" | head -20
```

```
<models/diffusion_models -name "*flux*" -o -name "*svdq*" | head -20
models/diffusion_models/svdq-int4_r32-flux.1-kontext-dev.safetensors
models/diffusion_models/flux1-dev-kontext_fp8_scaled.safetensors
models/diffusion_models/FLUX1/flux1-dev-fp8.safetensors
models/diffusion_models/svdq-int4_r32-flux.1-canny-dev.safetensors
models/diffusion_models/svdq-int4_r32-flux.1-dev.safetensors
models/diffusion_models/svdq-int4_r32-flux.1-fill-dev.safetensors
models/diffusion_models/svdq-int4-flux.1-schnell
models/diffusion_models/svdq-int4-flux.1-dev
wjx@Albert-B650E-AORUS-MASTER:~/ComfyUI$
```

---

现在让我检查出现问题的 svdq-fp4-flux.1-fill-dev 模型文件：

---

```bash
cd /home/wjx/ComfyUI && find models/diffusion_models -name "*svdq-fp4-flux.1-fill-dev*" -exec ls -la {} \;
```

```
<fusion_models -name "*svdq-fp4-flux.1-fill-dev*" -exec ls -la {} \;
wjx@Albert-B650E-AORUS-MASTER:~/ComfyUI$
```

---

看起来这个模型文件不存在。让我检查具体的错误信息，看看它在尝试从哪里加载模型：

---

Read file: undefined

---

让我检查这个文件的更多上下文，看看模型路径是如何确定的：

---

Read file: undefined

---

让我找到 model_path 是如何设置的：

---

Read file: undefined

---

现在我明白了问题所在。代码显示它试图从 `diffusion_models` 目录加载 `svdq-fp4-flux.1-fill-dev` 模型，但这个文件不存在。让我创建一个解决方案：

---

## Todo List

- [-] 检查所有可用的 FLUX 模型文件
- [ ] 确认缺失的 svdq-fp4-flux.1-fill-dev 模型
- [ ] 提供下载模型或使用替代模型的解决方案

---

让我检查可用的 FLUX 模型文件：

---

```bash
cd /home/wjx/ComfyUI && ls -la models/diffusion_models/*flux* models/diffusion_models/*svdq*
```

```
<s -la models/diffusion_models/*flux* models/diffusion_models/*svdq*
-rwxrwxr-x 1 wjx wjx 11904640136 Aug  3 20:00 models/diffusion_models/flux1-dev-kontext_fp8_scaled.safe
tensors
-rwxrwxr-x 1 wjx wjx  6768703136 Aug  3 18:07 models/diffusion_models/svdq-int4_r32-flux.1-canny-dev.sa
fetensors
-rwxrwxr-x 1 wjx wjx  6768703136 Aug  3 18:07 models/diffusion_models/svdq-int4_r32-flux.1-canny-dev.sa
fetensors
-rwxrwxr-x 1 wjx wjx  6433001472 Aug  3 20:00 models/diffusion_models/svdq-int4_r32-flux.1-dev.safetens
ors
-rwxrwxr-x 1 wjx wjx  6433001472 Aug  3 20:00 models/diffusion_models/svdq-int4_r32-flux.1-dev.safetens
ors
-rwxrwxr-x 1 wjx wjx  6770275936 Aug  3 18:07 models/diffusion_models/svdq-int4_r32-flux.1-fill-dev.saf
etensors
-rwxrwxr-x 1 wjx wjx  6770275936 Aug  3 18:07 models/diffusion_models/svdq-int4_r32-flux.1-fill-dev.saf
etensors
-rwxrwxr-x 1 wjx wjx  6768310048 Aug  3 18:06 models/diffusion_models/svdq-int4_r32-flux.1-kontext-dev.
safetensors
-rwxrwxr-x 1 wjx wjx  6768310048 Aug  3 18:06 models/diffusion_models/svdq-int4_r32-flux.1-kontext-dev.
safetensors

models/diffusion_models/svdq-int4-flux.1-dev:
total 6609708
drwxrwxr-x 2 wjx wjx       4096 Aug  3 20:01 .
drwxrwxr-x 5 wjx wjx       4096 Aug  3 20:00 ..
-rwxrwxr-x 1 wjx wjx        478 Aug  3 20:01 comfy_config.json
-rwxrwxr-x 1 wjx wjx        378 Aug  3 20:00 config.json
-rwxrwxr-x 1 wjx wjx       1519 Aug  3 20:01 gitattributes
-rwxrwxr-x 1 wjx wjx       1564 Aug  3 20:01 README.md
-rwxrwxr-x 1 wjx wjx 6640056352 Aug  3 20:01 transformer_blocks.safetensors
-rwxrwxr-x 1 wjx wjx  128252144 Aug  3 20:01 unquantized_layers.safetensors

models/diffusion_models/svdq-int4-flux.1-dev:
total 6609708
drwxrwxr-x 2 wjx wjx       4096 Aug  3 20:01 .
drwxrwxr-x 5 wjx wjx       4096 Aug  3 20:00 ..
-rwxrwxr-x 1 wjx wjx        478 Aug  3 20:01 comfy_config.json
-rwxrwxr-x 1 wjx wjx        378 Aug  3 20:00 config.json
-rwxrwxr-x 1 wjx wjx       1519 Aug  3 20:01 gitattributes
-rwxrwxr-x 1 wjx wjx       1564 Aug  3 20:01 README.md
-rwxrwxr-x 1 wjx wjx 6640056352 Aug  3 20:01 transformer_blocks.safetensors
-rwxrwxr-x 1 wjx wjx  128252144 Aug  3 20:01 unquantized_layers.safetensors

models/diffusion_models/svdq-int4-flux.1-schnell:
total 6589728
drwxrwxr-x 2 wjx wjx       4096 Aug  3 18:07 .
drwxrwxr-x 5 wjx wjx       4096 Aug  3 20:00 ..
-rwxrwxr-x 1 wjx wjx        486 Aug  3 18:07 comfy_config.json
-rwxrwxr-x 1 wjx wjx        321 Aug  3 18:07 config.json
-rwxrwxr-x 1 wjx wjx       1519 Aug  3 18:07 gitattributes
-rwxrwxr-x 1 wjx wjx        880 Aug  3 18:07 README.md
-rwxrwxr-x 1 wjx wjx 6640056352 Aug  3 18:07 transformer_blocks.safetensors
-rwxrwxr-x 1 wjx wjx  107792136 Aug  3 18:07 unquantized_layers.safetensors

models/diffusion_models/svdq-int4-flux.1-schnell:
total 6589728
drwxrwxr-x 2 wjx wjx       4096 Aug  3 18:07 .
drwxrwxr-x 5 wjx wjx       4096 Aug  3 20:00 ..
-rwxrwxr-x 1 wjx wjx        486 Aug  3 18:07 comfy_config.json
-rwxrwxr-x 1 wjx wjx        321 Aug  3 18:07 config.json
-rwxrwxr-x 1 wjx wjx       1519 Aug  3 18:07 gitattributes
-rwxrwxr-x 1 wjx wjx        880 Aug  3 18:07 README.md
-rwxrwxr-x 1 wjx wjx 6640056352 Aug  3 18:07 transformer_blocks.safetensors
-rwxrwxr-x 1 wjx wjx  107792136 Aug  3 18:07 unquantized_layers.safetensors
wjx@Albert-B650E-AORUS-MASTER:~/ComfyUI$
```

---

## Todo List

- [x] 检查所有可用的 FLUX 模型文件
- [-] 确认缺失的 svdq-fp4-flux.1-fill-dev 模型
- [ ] 提供下载模型或使用替代模型的解决方案

---

让我检查 FLUX 目录中的完整模型：

---

```bash
cd /home/wjx/ComfyUI && ls -la models/diffusion_models/FLUX1/
```

```
<d /home/wjx/ComfyUI && ls -la models/diffusion_models/FLUX1/
total 16842324
drwxrwxr-x 2 wjx wjx        4096 Aug  3 18:06 .
drwxrwxr-x 5 wjx wjx        4096 Aug  3 20:00 ..
-rwxrwxr-x 1 wjx wjx 17246524772 Aug  3 18:07 flux1-dev-fp8.safetensors
wjx@Albert-B650E-AORUS-MASTER:~/ComfyUI$
```

---

现在我明白了问题。您的系统缺少 `svdq-fp4-flux.1-fill-dev.safetensors` 模型文件。您只有 INT4 版本的模型，但工作流程试图加载 FP4 版本。

---

## Todo List

- [x] 检查所有可用的 FLUX 模型文件
- [x] 确认缺失的 svdq-fp4-flux.1-fill-dev 模型
- [-] 提供下载模型或使用替代模型的解决方案

---

## 问题分析

根据错误信息和系统检查，问题的原因是：

**缺少模型文件**：您的工作流程尝试加载 `svdq-fp4-flux.1-fill-dev` 模型，但这个文件在您的系统中不存在。

**现有的模型**：
- `svdq-int4_r32-flux.1-fill-dev.safetensors` (INT4 版本)
- `svdq-int4_r32-flux.1-dev.safetensors` 
- `svdq-int4_r32-flux.1-kontext-dev.safetensors`
- `flux1-dev-fp8.safetensors`

## 解决方案

您有三个选择：

### 方案1：使用现有的 INT4 模型（推荐）
修改工作流程中的节点设置，将模型名称从 `svdq-fp4-flux.1-fill-dev` 改为 `svdq-int4_r32-flux.1-fill-dev.safetensors`。

### 方案2：下载 FP4 模型
如果您需要 FP4 模型的特定性能，可以从以下地址下载：
- [HuggingFace - nunchaku FLUX models](https://huggingface.co/mit-han-lab)
- [ModelScope](https://modelscope.cn/models/Lmxyy1999/)

### 方案3：使用标准 FLUX 模型
使用您已有的完整 FLUX 模型 `flux1-dev-fp8.safetensors`。

## 推荐操作

最简单的解决方案是**使用方案1**，因为您已经有了对应的 INT4 版本模型。只需在 ComfyUI 的工作流程中将 `NunchakuFluxDiTLoader` 节点的模型选择从 `svdq-fp4-flux.1-fill-dev` 改为 `svdq-int4_r32-flux.1-fill-dev.safetensors`。

**注意**：根据您的 GPU (RTX 4080 SUPER) 有 16GB 显存，INT4 模型应该能很好地运行，并且通常提供更好的兼容性。

您希望我帮您修改工作流程文件，还是您更倾向于下载 FP4 模型？

---

## Todo List

- [x] 检查所有可用的 FLUX 模型文件
- [x] 确认缺失的 svdq-fp4-flux.1-fill-dev 模型
- [x] 提供下载模型或使用替代模型的解决方案

---

