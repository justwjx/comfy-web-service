## 项目问题清单 (Issue List)

记录项目运行中的已知问题、根因、规避/修复方案与验证步骤，便于后续快速对照排查。

### 使用方式
- 新增问题时，复制下方“问题模板”，按实际情况填写。
- 为每个问题分配唯一编号，例如 Issue-0002、Issue-0003。
- 建议每次修复后补充“验证清单”与“修复版本”。

### 索引
- Issue-0001: 首页卡在“正在加载”（转圈）

---

### Issue-0001: 首页卡在“正在加载”（转圈）
- 编号: Issue-0001
- 状态: 已定位，已有规避方案
- 严重级别: 中
- 首次发现版本: a4e9d48
- 受影响版本: a4e9d48（以及任何包含同样引用但未提供定义的版本）
- 已知稳定版本: 5272915
- 关联提交: 5272915, a4e9d48

#### 现象
- 进入首页后，页面一直显示“正在加载”，无法正常展示工作流列表。

#### 复现步骤
1. 切换到提交 a4e9d48。
2. 启动服务并打开首页。
3. 页面停留在加载态；浏览器控制台可见报错。

#### 期望/实际
- 期望: 首页正常初始化并展示工作流入口。
- 实际: 页面初始化中断，停在加载转圈。

#### 根因分析
- 在 a4e9d48 的 `static/js/app.js` 中新增了对 `PromptTemplates` 的实例化：

```text
this.promptTemplates = new PromptTemplates();
```

- 但代码库中不存在 `PromptTemplates` 类定义（未找到 `class PromptTemplates` 或相关导入）。
- 运行时触发 `ReferenceError: PromptTemplates is not defined`，使应用初始化流程中断，导致页面卡住。

#### 影响面
- 首页初始化流程（`ComfyWebApp` 构造与后续初始化）被异常中止。

#### 临时规避
- 回退到稳定版本 `5272915`：

```bash
git reset --hard 5272915
```

- 或在问题版本中移除对 `PromptTemplates` 的直接引用与依赖调用，确保无未定义符号。

#### 永久修复建议
- 方案A：真正引入 `PromptTemplates` 模块（例如新增 `static/js/prompt-templates.js` 并在页面中加载），确保类定义与使用一致；
- 方案B：为模板相关能力做特性探测与懒加载，所有调用前增加存在性校验与降级路径；
- 方案C：如短期不需要该功能，彻底移除 `PromptTemplates` 的实例化与依赖方法（如模板分类/随机模板等 UI）。

#### 验证清单
- [ ] 首页能够正常渲染，不再停留在加载态；
- [ ] 浏览器控制台无 `ReferenceError` 或未定义类/函数报错；
- [ ] 模板管理相关入口（如仍保留）可正常显示或优雅降级；
- [ ] 主要交互（加载工作流、生成、切换模式）均正常。

#### 旁证与命令
- 差异对比（示例）：

```bash
git diff 5272915..a4e9d48 -- static/js/app.js
```

- 搜索未定义类：

```bash
rg "class\s+PromptTemplates|PromptTemplates\W" static/js
```

---

### 问题模板（复制使用）

```markdown
### Issue-XXXX: <简要标题>
- 编号: Issue-XXXX
- 状态: 待确认/处理中/已定位/已修复
- 严重级别: 低/中/高/致命
- 首次发现版本: <commit 或 tag>
- 受影响版本: <范围或列表>
- 已知稳定版本: <可回退版本>
- 关联提交: <提交哈希/PR/Issue 链接>

#### 现象
- <描述用户可见的表现>

#### 复现步骤
1. <步骤1>
2. <步骤2>
3. <步骤3>

#### 期望/实际
- 期望: <期望行为>
- 实际: <实际行为>

#### 根因分析
- <技术分析与定位结论>

#### 影响面
- <受影响模块/功能/用户群>

#### 临时规避
- <短期可落地的止血方案>

#### 永久修复建议
- <从架构/实现/流程上杜绝问题的方案>

#### 验证清单
- [ ] <验证点1>
- [ ] <验证点2>
- [ ] <验证点3>

#### 旁证与命令
```bash
<用于对照/排查的命令或日志位置>
```
```


